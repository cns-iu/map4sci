version: '3.9'
services:
  map4sci:
    image: map4sci:latest
    deploy:
      resources:
        limits:
          cpus: '0.75'
          memory: 12G
        reservations:
          cpus: '0.25'
          memory: 3G
    volumes:
      - type: bind
        source: ./data-processor/datasets
        target: /workspace/data-processor/datasets
      - type: bind
        source: ./data-processor/raw-data
        target: /workspace/data-processor/raw-data
      - type: bind
        source: ./data-processor/site
        target: /workspace/data-processor/site
      - type: bind
        source: ./data-processor/src
        target: /workspace/data-processor/src
      - type: bind
        source: ./data-processor/scripts
        target: /workspace/data-processor/scripts
    stdin_open: true # docker run -i
    tty: true # docker run -t
    working_dir: /workspace/data-processor/
    environment:
      - CURRENT_DATASET
      - CURRENT_VERSION
    command: /bin/bash -c 'cd /workspace/data-processor/ && ./run.sh'
